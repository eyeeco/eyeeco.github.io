<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>MySQL数据库 | MapleStory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="数据库">
  
  
  
  
  <meta name="description" content="[TOC] 数据库MySQL事务事务的概念、隔离级别、死锁见「数据库系统原理」">
<meta name="keywords" content="数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL数据库">
<meta property="og:url" content="http://yoursite.com/2018/12/23/MySQL数据库/index.html">
<meta property="og:site_name" content="MapleStory">
<meta property="og:description" content="[TOC] 数据库MySQL事务事务的概念、隔离级别、死锁见「数据库系统原理」">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="http://yoursite.com/2018/12/23/MySQL数据库/1544671253199.png">
<meta property="og:image" content="http://yoursite.com/2018/12/23/MySQL数据库/1544671316581.png">
<meta property="og:image" content="http://yoursite.com/2018/12/23/MySQL数据库/1544680914971.png">
<meta property="og:updated_time" content="2018-12-23T07:41:18.782Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL数据库">
<meta name="twitter:description" content="[TOC] 数据库MySQL事务事务的概念、隔离级别、死锁见「数据库系统原理」">
<meta name="twitter:image" content="http://yoursite.com/2018/12/23/MySQL数据库/1544671253199.png">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css">

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  


<header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="MapleStory" rel="home"> MapleStory </a>
            
          </h1>
          
          
            <div class="site-description">CS:Dalian University of technology</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows" style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-MySQL数据库" style="width: 66%; float:left;" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      MySQL数据库
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/12/23/MySQL数据库/" class="article-date">
	  <time datetime="2018-12-23T07:38:24.000Z" itemprop="datePublished">十二月 23, 2018</time>
	</a>

       
      
	<span id="busuanzi_container_page_pv">
	  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	</span>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="MySQL事务"><a href="#MySQL事务" class="headerlink" title="MySQL事务"></a>MySQL事务</h3><h4 id="事务的概念、隔离级别、死锁"><a href="#事务的概念、隔离级别、死锁" class="headerlink" title="事务的概念、隔离级别、死锁"></a>事务的概念、隔离级别、死锁</h4><p>见「数据库系统原理」</p>
<a id="more"></a>
<h4 id="事务日志"><a href="#事务日志" class="headerlink" title="事务日志"></a>事务日志</h4><p>事务日志可以帮助提高事务的效率，使用事务日志，在储存引擎上修改表时数据只需要修改其内存拷贝，再把修改行为记录到硬盘上的持久事务中，而不用每次都将修改的数据本身持久到磁盘</p>
<p>事务日志采用追加方式，因此日志操作是顺序I/O。采用事务日志速度快。事务日志持久后，内存中被修改的数据主键被刷回磁盘，大多数储存引擎都是这么实现的。这被称为<strong>预写日志</strong>，修改数据两次写磁盘</p>
<p>如果数据的修改已经持久化，而数据本身没被写入磁盘，系统崩溃后储存引擎在重启时自动恢复修改的数据。</p>
<h4 id="MySQL自动提交"><a href="#MySQL自动提交" class="headerlink" title="MySQL自动提交"></a>MySQL自动提交</h4><p>MySQL默认采用自动提交，不是显示的开始一个事务，每个查询都被当成一个事务提交。</p>
<p>有一些命令会强制提交当前的活动事务，如<code>Alter</code></p>
<p>MySQL可以设置所有的四个隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">read</span> committed</span><br></pre></td></tr></table></figure>
<h4 id="事务中混用储存引擎"><a href="#事务中混用储存引擎" class="headerlink" title="事务中混用储存引擎"></a>事务中混用储存引擎</h4><p>MySQL不管理事务，事务由引擎实现，所以在一个中混用引擎是不可靠的</p>
<p>事务回滚对于非事务型表（如<code>MyISAM</code>）无法撤销，数据库会失去一致性</p>
<h4 id="隐式和显示锁定"><a href="#隐式和显示锁定" class="headerlink" title="隐式和显示锁定"></a>隐式和显示锁定</h4><p><code>InnoDB</code>采用两阶段锁定协议，事务执行过程中随时可以执行锁定，只有在commit和rollback时释放，并且所有的锁在同一时刻释放，这些属于隐式锁，<code>InnoDB</code>在需要时自动加锁</p>
<p>同样<code>InnoDB</code>支持显示加锁，一般来说显示使用LOCK TABLES语句不但没有必要还会严重影响性能，实际上<code>InnoDB</code>行锁性能更好</p>
<h3 id="MySQL并发控制"><a href="#MySQL并发控制" class="headerlink" title="MySQL并发控制"></a>MySQL并发控制</h3><h4 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h4><p>详见「数据库系统原理」</p>
<h4 id="锁粒度"><a href="#锁粒度" class="headerlink" title="锁粒度"></a>锁粒度</h4><p>一种提高资源并发的方式是让锁的对象更有选择性。尽量只锁需要修改的部分数据，而不是所有的资源。任何时候，互相之间不发生冲突，锁的数量越少并发程度越高。</p>
<p>加锁也需要消耗资源，获得锁、检查锁、释放锁都会增大开销。所谓锁策略，就是在所的开销和安全性之间寻求一种平衡。大多数商业数据库没有提供更多的选择，一般是在表上施加行级锁。而MySQL提供可多种选择，每种储存引擎都可以实现自己的锁策略和锁粒度</p>
<ul>
<li>表锁</li>
</ul>
<p>表锁是MySQL中最基本的锁策略，并且是开销最小的锁。它锁定整张表，用户对表的写操作都需要获得整个锁</p>
<p>尽管储存引擎管理自己的锁，MySQL本身还是会使用有效的表锁，例如<code>Alter table</code>语句使用表锁</p>
<ul>
<li>行级锁</li>
</ul>
<p>行级锁可以最大程度的支持并发处理（最大的锁开销），<code>InnoDB</code>及<code>XtraDB</code>实现了行级锁，行级锁只在引擎层面实现，而服务器层面并不了解锁的情况</p>
<h4 id="MySQL多版本并发控制（MVCC）"><a href="#MySQL多版本并发控制（MVCC）" class="headerlink" title="MySQL多版本并发控制（MVCC）"></a>MySQL多版本并发控制（MVCC）</h4><p>MySQL实现了自己的多版本并发控制（MVCC），可以认为MVCC是行级锁的一个变种，它在很多情况下避免了加锁操作，因此开销更低。</p>
<p>MVCC的实现是通过保存数据在某个时间点的快照来实现的。不管需要执行多长时间，每个事务看到的数据都是一致的。根据事务开始的时间不同，事务对同一张表，同一时刻数据可能是不一样的</p>
<p><code>InnoDB</code>的MVCC是通过在每个记录后面保存两个隐藏的列来实现的。这两个列一个保存了行的创建时间，一个保存了行的过期时间。当然储存的是系统版本号。每开始一个事务，系统版本号都会递增，事务开始时刻的系统版本号作为事务的版本号。</p>
<ul>
<li><p>SELECT</p>
<p><code>InnoDB</code>会根据以下两个条件检查记录</p>
<p>A. <code>InnoDB</code>只查找版本早于当前事务版本的数据行，这样可以确保事务读取的行要么在开始前存在，要么自身插入或修改</p>
<p>B. 行的删除版本要么未定义，要么大于当前事务版本号。这样可以确保事务读到的行在事务开始前未被删除</p>
</li>
<li><p>INSERT</p>
<p><code>InnoDB</code>为新插入的每一行保存当前系统的版本号</p>
</li>
<li><p>DELETE</p>
<p><code>InnoDB</code>为每一行保存当前系统的版本号作为删除标识</p>
</li>
<li><p>UPDATE</p>
<p><code>InnoDB</code>插入一行新的记录，保存当前系统的版本号，同时保存当前系统到原来的行作为删除标识</p>
</li>
</ul>
<p>这样通过版本号的方法使得大多数读操作不需要加锁。</p>
<p>MVCC只在可重复读和已提交读两个隔离级别工作，其他的隔离级别与MVCC不兼容</p>
<h3 id="MySQL引擎"><a href="#MySQL引擎" class="headerlink" title="MySQL引擎"></a>MySQL引擎</h3><h4 id="InnoDB-储存引擎"><a href="#InnoDB-储存引擎" class="headerlink" title="InnoDB 储存引擎"></a><code>InnoDB</code> 储存引擎</h4><p><code>InnoDB</code>是MySQL默认的事务型引擎，也是最重要，最广泛使用的储存引擎。它被设计用来处理大量的短期事务，短期事务大部分情况下都是正常提交的，很少被回滚。<code>InnoDB</code>的性能和崩溃自动回复的特性使其在非事务型储存的需求中也很流行。</p>
<p><code>InnoDB</code>数据储存在表空间中，表空间是<code>InnoDB</code>管理的一个黑盒子，由一系列数据文件组成。</p>
<p><code>InnoDB</code>通过MVCC来支持高并发，并且实现了四个标准的隔离级别，其默认级别是可重复读，并且通过间隙锁策略防止幻读的出现。间隙锁使得<code>InnoDB</code>不仅仅锁定查询涉及的行，还会对索引的间隙进行锁定。</p>
<p><code>InnoDB</code>表基于聚簇索引建立。<code>InnoDB</code>和MySQL其他引擎有很大不同，聚簇索引对主键的查询有很高的性能。不过他的二级索引必须包含主键列，所以如果主键很大的话，其他的二级索引就会很大。所以索引较多的话主键应尽可能的小</p>
<p><code>InnoDB</code>内部有很多优化，从磁盘读数据的可预测性读，自动创建hash索引，插入缓冲器操作。</p>
<h4 id="MyISAM引擎"><a href="#MyISAM引擎" class="headerlink" title="MyISAM引擎"></a><code>MyISAM</code>引擎</h4><p>在MySQL5.1之前的版本，<code>MyISAM</code>都是默认的储存引擎，MySQL有几个致命的缺点</p>
<ol>
<li>不支持事务和行级锁</li>
<li>崩溃后无法安全恢复</li>
</ol>
<p>但其优点在于对于只读数据，速度较快</p>
<p><code>MyISAM</code>将表储存在两个文件中，数据文件和索引文件，采用非聚簇索引（详见索引部分）</p>
<h4 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h4><ul>
<li>事务： I 是事务型的，支持提交和回滚</li>
<li>并发：M 只支持表级锁， I 还支持行级锁</li>
<li>外键： I 支持外键</li>
<li>备份： I支持在线热备份</li>
<li>崩溃恢复： M崩溃后损坏的几率较高，I 有完善的日志恢复机制</li>
</ul>
<h3 id="MySQL索引"><a href="#MySQL索引" class="headerlink" title="MySQL索引"></a>MySQL索引</h3><p>索引（在MySQL中也称键）是储存引擎用于快速找到记录的一种数据结构。索引对于良好的性能非常关键。</p>
<p>索引优化是对查询性能优化最有效的手段，能够轻易将查询性能提升若干个数量级。</p>
<h4 id="索引基础"><a href="#索引基础" class="headerlink" title="索引基础"></a>索引基础</h4><h5 id="B-树索引"><a href="#B-树索引" class="headerlink" title="B-树索引"></a>B-树索引</h5><p>B-树索引是人们经过长期探索发展出目前最适合数据库系统的数据结构，它高效的利用了索引以及机械磁盘的空间。在大多数情况下爱，其不需要全表扫描来获取需要的数据，取而代之的是从根节点进行搜索，依次根据指针向下查找。B树索引有以下特点：</p>
<ul>
<li>全值匹配 与所有列匹配</li>
<li>匹配最左前缀 索引查找性为“Allen”的人</li>
<li>匹配列前缀 like “J%”</li>
<li>匹配范围值</li>
<li>精确匹配某一列与并范围匹配某一列 </li>
<li>只访问索引查询（覆盖索引）</li>
</ul>
<p>B树索引的不足</p>
<ul>
<li>如果不是从最左列开始，则无法使用查找</li>
<li>不能跳过索引中的列</li>
<li>范围列的右侧无法再使用索引</li>
</ul>
<p>可以发现，索引列的顺序十分重要</p>
<h5 id="hash索引"><a href="#hash索引" class="headerlink" title="hash索引"></a>hash索引</h5><p>hash索引基于哈希表实现，只有精确匹配所有列的查询才有效。每一行数据索引都会计算一个hash码</p>
<p>hash查找速度很快，但也有以下限制：</p>
<ul>
<li>hash索引只包含hash值和行指针，而不储存字段的值</li>
<li>hash索引并不是按照索引值储存，无法排序</li>
<li>hash索引不支持部分索引的匹配查找，只支持等值查找</li>
</ul>
<p>值得注意的是，<code>InnoDB</code>有一个特殊的功能叫自适应哈希索引，当<code>InnoDB</code>某些值使用非常频繁时，他会在内存中基于B树再创建一个hash索引</p>
<h5 id="索引的优点"><a href="#索引的优点" class="headerlink" title="索引的优点"></a>索引的优点</h5><ul>
<li>索引大大减小了服务器需要扫描的数据量</li>
<li>索引可以帮助服务器避免排序和临时表</li>
<li>索引可以将随机IO变为顺序IO</li>
</ul>
<h4 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h4><p>聚簇索引并不是一种单独的索引类型，而是一种数据储存方式。当表有聚簇索引时，表示数据行和相邻的键值紧凑的储存在一起。一个表只能有一个聚簇索引。</p>
<p><code>InnoDB</code>默认通过主键来聚集数据</p>
<p>如果没有定义主键、<code>InnoDB</code>会选择一个唯一的非空索引，如果没有这样的索引，<code>InnoDB</code>会隐式的定义一个主键作为聚簇索引的主键</p>
<h5 id="聚簇索引的优点"><a href="#聚簇索引的优点" class="headerlink" title="聚簇索引的优点"></a>聚簇索引的优点</h5><ul>
<li>可以把相关数据保存在一起，例如根据用户ID来聚集数据，这样可以最小化磁盘读取数据页</li>
<li>数据访问更快，举措索引将索引和数据保存在统一个B树中，因此聚簇比非聚簇索引的查找更快</li>
<li>覆盖索引世界使用主键值</li>
</ul>
<h5 id="聚簇索引的缺点"><a href="#聚簇索引的缺点" class="headerlink" title="聚簇索引的缺点"></a>聚簇索引的缺点</h5><ul>
<li>聚簇索引最大限度提高IO密集应用的性能，但是数据如果都在内存中（例如缓存）访问顺序就不重要了</li>
<li>插入速度依赖于插入顺序</li>
<li>更新聚簇索引列的代价很高，强制每个更新移动到位</li>
<li>页分裂问题</li>
<li>聚簇索引可能导致全表扫描变慢（尤其是稀疏表时）</li>
<li>二级索引可能比想象的大，因为二级索引叶子节点包含了主键列</li>
</ul>
<h4 id="InnoDB和MyISAM的数据分布对比"><a href="#InnoDB和MyISAM的数据分布对比" class="headerlink" title="InnoDB和MyISAM的数据分布对比"></a><code>InnoDB</code>和<code>MyISAM</code>的数据分布对比</h4><p><code>MyISAM</code> 数据分布很简单，数据按照插入数据储存在磁盘上</p>
<p>它很容易创建索引，并且，索引没有什么不同</p>
<p><img src="/2018/12/23/MySQL数据库/1544671253199.png" alt=""></p>
<p>这是索引1号 Col1</p>
<p><img src="/2018/12/23/MySQL数据库/1544671316581.png" alt=""></p>
<p>这是索引2号Col2</p>
<p>而<code>InnoDB</code>支持聚簇数据，使用非常不同的方式储存同样的数据。</p>
<p><img src="/2018/12/23/MySQL数据库/1544680914971.png" alt="1544680914971"></p>
<p>该图显示整个表，而非只有索引，<code>InnoDB</code>中聚簇索引就是表</p>
<p>聚簇索引的每一个指针都包含了主键值、事务ID、事务及MVCC的回滚指针及所有的剩余列。</p>
<p>还有一个重要的不同， <code>InnoDb</code>的二级索引和聚簇索引有很多不同，其叶子节点储存的不是行指针而是主键值。</p>
<h4 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h4><p>索引是一种查找数据的方式，但是MySQL也可以使用索引来直接获取列的数据，这样就不需要读取数据的行。</p>
<ul>
<li>如果一个索引包含（或者说覆盖）所有要查询字段的值，我们就称之为“覆盖索引。<strong>！！覆盖索引从辅助索引中即可得到查询数据，简单的说就是辅助索引就包含了所要查询的值！！</strong></li>
<li>例如创建某个辅助索引（name、age）查询数据时，select username,age from user where username=’Java’ and age = 22 要查询的列叶子节点都存在，不需要回表索引若干问</li>
</ul>
<h3 id="索引若干问"><a href="#索引若干问" class="headerlink" title="索引若干问"></a>索引若干问</h3><h4 id="使用索引的原因？"><a href="#使用索引的原因？" class="headerlink" title="使用索引的原因？"></a>使用索引的原因？</h4><p>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性；</p>
<p>大大加快数据的检索速度（这是创建索引最重要的原因）；</p>
<p>帮助服务器避免排序和临时表，将随机IO变为顺序IO；</p>
<p>加速表与表之间的连接，在实现数据参考完整性方面有重要意义；</p>
<h4 id="为什么不对每一列创建索引？"><a href="#为什么不对每一列创建索引？" class="headerlink" title="为什么不对每一列创建索引？"></a>为什么不对每一列创建索引？</h4><p>当数据增加、删除和修改时，索引也需要动态维护，这样就降低了数据的维护速度</p>
<p>除了数据表占数据空间之外，索引还要需要占据一定的物理空间，如果建立聚簇索引，空间占用更大</p>
<p>创建、维护索引耗费时间、这种耗费随数据量增加而增加</p>
<h4 id="索引提高查询速度的原因？"><a href="#索引提高查询速度的原因？" class="headerlink" title="索引提高查询速度的原因？"></a>索引提高查询速度的原因？</h4><p>将无序的数据变成相对有序的数据（像查目录一样）</p>
<h4 id="常用索引使用的数据结构？"><a href="#常用索引使用的数据结构？" class="headerlink" title="常用索引使用的数据结构？"></a>常用索引使用的数据结构？</h4><ul>
<li><p>哈希索引</p>
<p>对于哈希索引来说，底层函数就是一个hash表，因此在大多数需求为单条记录的查询时，可以选择hash索引，查询性能较快</p>
</li>
<li><p><code>BTree</code>索引</p>
<p><code>Mysql</code>使用的是B+树索引，但是对于两种引擎的实现不同</p>
</li>
</ul>
<h4 id="MyISAM和InnoDB实现B-树索引的区别"><a href="#MyISAM和InnoDB实现B-树索引的区别" class="headerlink" title="MyISAM和InnoDB实现B+树索引的区别"></a><code>MyISAM</code>和<code>InnoDB</code>实现B+树索引的区别</h4><p><strong><code>MyISAM</code>:</strong> B+树叶节点data域存放的是数据记录的地址，在索引检索的时候，首先按照B+树 算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址读取相应的数据记录，被称为”非聚簇索引”</p>
<p><code>InnoDB</code>: 数据文件本身就是索引文件，相比于<code>MyISAM</code> 索引文件和数据文件是分离的，其表结构本身就是按B+Tree组织的一个索引结构，树的叶节点data域保存了完整的整条数据记录，这个索引的key正是数据表的主键，因此<code>InnoDB</code>本身就是主索引，这被称为“聚簇索引（聚集索引）”，而其余的索引被作为辅助索引，辅助索引data域储存记录主键的值而不是地址。这样根据辅助索引查找时，先取出主键的值，再走一遍主索引。因此设计表时主键的选择十分重要，主键不宜过长也不宜非单调。</p>
<h4 id="索引的注意事项"><a href="#索引的注意事项" class="headerlink" title="索引的注意事项"></a>索引的注意事项</h4><ul>
<li>在经常需要索引的列上加快搜索速度</li>
<li>在经常使用where子句上索引加快条件判断速度</li>
<li>在经常需要排序的列上创建索引，因为索引已经排序，这样加快排序的查询时间</li>
<li>中、大型表的排序都是有效的，但是特大型表不适合建索引</li>
<li>在经常用到的连接上建索引，这些外键索引加快速度</li>
<li>避免where子句对字段加函数，这样无法命中索引</li>
<li>在<code>InnoDB</code>中使用与业务无关的自增主键作为主键，使用逻辑主键，不使用业务主键</li>
<li>索引列 NOT NULL，否者引擎将放弃索引</li>
<li>删除长期不使用索引、不使用索引的存在会造成比必要的性能损耗</li>
</ul>
<h4 id="索引原则（高性能Mysql）"><a href="#索引原则（高性能Mysql）" class="headerlink" title="索引原则（高性能Mysql）"></a>索引原则（高性能<code>Mysql</code>）</h4><ul>
<li>单行访问很慢，特别是机械硬盘。如果从数据中读取的一个数据库只获取一行，浪费很多工作，最好读取尽可能多的行。</li>
<li>顺序访问范围数据是很快的。第一，顺序I/O不需要多次的磁盘寻道，比随机I/O快的多。第二、服务器按顺序读取数据，不需要额外的排序操作，group by  也无需再次排序</li>
<li>索引的覆盖查询时很快的，如果一个索引包含了查询所有的列，那么储存引擎就不需要再回表查询行，这避免了大量的单行访问</li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/12/23/C-常用编程技术/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          C++常用编程技术
        
      </div>
    </a>
  
  
    <a href="/2018/12/23/图书指南/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">图书指南</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库"><span class="nav-number">1.</span> <span class="nav-text">数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL事务"><span class="nav-number">1.1.</span> <span class="nav-text">MySQL事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#事务的概念、隔离级别、死锁"><span class="nav-number">1.1.1.</span> <span class="nav-text">事务的概念、隔离级别、死锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事务日志"><span class="nav-number">1.1.2.</span> <span class="nav-text">事务日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL自动提交"><span class="nav-number">1.1.3.</span> <span class="nav-text">MySQL自动提交</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事务中混用储存引擎"><span class="nav-number">1.1.4.</span> <span class="nav-text">事务中混用储存引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#隐式和显示锁定"><span class="nav-number">1.1.5.</span> <span class="nav-text">隐式和显示锁定</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL并发控制"><span class="nav-number">1.2.</span> <span class="nav-text">MySQL并发控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#读写锁"><span class="nav-number">1.2.1.</span> <span class="nav-text">读写锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#锁粒度"><span class="nav-number">1.2.2.</span> <span class="nav-text">锁粒度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL多版本并发控制（MVCC）"><span class="nav-number">1.2.3.</span> <span class="nav-text">MySQL多版本并发控制（MVCC）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL引擎"><span class="nav-number">1.3.</span> <span class="nav-text">MySQL引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#InnoDB-储存引擎"><span class="nav-number">1.3.1.</span> <span class="nav-text">InnoDB 储存引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MyISAM引擎"><span class="nav-number">1.3.2.</span> <span class="nav-text">MyISAM引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#比较"><span class="nav-number">1.3.3.</span> <span class="nav-text">比较</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL索引"><span class="nav-number">1.4.</span> <span class="nav-text">MySQL索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#索引基础"><span class="nav-number">1.4.1.</span> <span class="nav-text">索引基础</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#B-树索引"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">B-树索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#hash索引"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">hash索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#索引的优点"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">索引的优点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#聚簇索引"><span class="nav-number">1.4.2.</span> <span class="nav-text">聚簇索引</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#聚簇索引的优点"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">聚簇索引的优点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#聚簇索引的缺点"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">聚簇索引的缺点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InnoDB和MyISAM的数据分布对比"><span class="nav-number">1.4.3.</span> <span class="nav-text">InnoDB和MyISAM的数据分布对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#覆盖索引"><span class="nav-number">1.4.4.</span> <span class="nav-text">覆盖索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引若干问"><span class="nav-number">1.5.</span> <span class="nav-text">索引若干问</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用索引的原因？"><span class="nav-number">1.5.1.</span> <span class="nav-text">使用索引的原因？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么不对每一列创建索引？"><span class="nav-number">1.5.2.</span> <span class="nav-text">为什么不对每一列创建索引？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#索引提高查询速度的原因？"><span class="nav-number">1.5.3.</span> <span class="nav-text">索引提高查询速度的原因？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#常用索引使用的数据结构？"><span class="nav-number">1.5.4.</span> <span class="nav-text">常用索引使用的数据结构？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MyISAM和InnoDB实现B-树索引的区别"><span class="nav-number">1.5.5.</span> <span class="nav-text">MyISAM和InnoDB实现B+树索引的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#索引的注意事项"><span class="nav-number">1.5.6.</span> <span class="nav-text">索引的注意事项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#索引原则（高性能Mysql）"><span class="nav-number">1.5.7.</span> <span class="nav-text">索引原则（高性能Mysql）</span></a></li></ol></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2018 MapleStory All Rights Reserved.
        
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
